<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Observaciones de Seguridad</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root {
      --primary-blue: #1a73e8;
      --dark-blue: #0d47a1;
      --light-blue: #e8f0fe;
      --primary-green: #34a853;
      --dark-green: #1e8e3e;
      --light-green: #e6f4ea;
      --white: #ffffff;
      --light-gray: #f5f5f5;
      --medium-gray: #e0e0e0;
      --dark-gray: #5f6368;
      --black: #202124;
      --border-radius: 8px;
      --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Google Sans', Roboto, Arial, sans-serif;
    }
    
    body {
      background-color: var(--light-gray);
      color: var(--black);
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    header {
      background-color: var(--white);
      box-shadow: var(--box-shadow);
      padding: 1rem 0;
      margin-bottom: 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--primary-blue);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .logo-icon {
      color: var(--primary-green);
    }
    
    .auth-section {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background-color: var(--primary-blue);
      color: var(--white);
    }
    
    .btn-primary:hover {
      background-color: var(--dark-blue);
    }
    
    .btn-success {
      background-color: var(--primary-green);
      color: var(--white);
    }
    
    .btn-success:hover {
      background-color: var(--dark-green);
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary-blue);
      color: var(--primary-blue);
    }
    
    .btn-outline:hover {
      background-color: var(--light-blue);
    }
    
    /* Formulario mejorado */
    .form-container {
      background-color: var(--white);
      padding: 2.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin-bottom: 2rem;
    }
    
    h2 {
      color: var(--primary-blue);
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1.8rem;
    }
    
    .form-section {
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      background-color: var(--light-gray);
      border-radius: var(--border-radius);
      border-left: 4px solid var(--primary-blue);
    }
    
    .form-section h3 {
      margin-top: 0;
      color: var(--primary-blue);
      border-bottom: 1px solid var(--medium-gray);
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    
    label {
      display: block;
      margin: 1rem 0 0.5rem;
      font-weight: 500;
      color: var(--dark-gray);
    }
    
    input, textarea, select {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
      box-sizing: border-box;
      font-size: 1rem;
      transition: var(--transition);
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px var(--light-blue);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .radio-group, .checkbox-group {
      margin-bottom: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .radio-group label, .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: normal;
      cursor: pointer;
      padding: 0.5rem 0;
    }
    
    .form-row {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1rem;
    }
    
    .form-row > div {
      flex: 1;
    }
    
    /* Panel de administración */
    .admin-panel {
      display: none;
      margin-top: 2rem;
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background-color: var(--white);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      text-align: center;
    }
    
    .stat-card h3 {
      color: var(--dark-gray);
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .stat-card .value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-blue);
    }
    
    .stat-card.green .value {
      color: var(--primary-green);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: var(--white);
      box-shadow: var(--box-shadow);
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    
    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    th {
      background-color: var(--primary-blue);
      color: var(--white);
      font-weight: 500;
    }
    
    tr:hover {
      background-color: var(--light-blue);
    }
    
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .badge-safe {
      background-color: var(--light-green);
      color: var(--dark-green);
    }
    
    .badge-unsafe {
      background-color: #fce8e6;
      color: #d93025;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .stats-cards {
        grid-template-columns: 1fr;
      }
      
      nav {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }
      
      .auth-section {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="#" class="logo">
        <span class="logo-icon">🔒</span>
        <span>SeguridadPlus</span>
      </a>
      <div class="auth-section">
        <button id="loginBtn" class="btn btn-outline">Iniciar Sesión</button>
        <button id="logoutBtn" class="btn btn-danger" style="display: none;">Cerrar Sesión</button>
      </div>
    </nav>
  </header>
  
  <div class="container">
    <!-- Formulario de Observaciones -->
    <div class="form-container" id="observationFormContainer">
      <h2>Sistema de Observaciones de Seguridad</h2>
      
      <form id="observationForm">
        <!-- Secciones del formulario permanecen iguales -->
        <!-- ... -->
        
        <button type="button" onclick="uploadData()" class="btn btn-primary">
          <span>📋</span> Guardar Observación
        </button>
        <button type="button" id="exportBtn" onclick="exportToExcel()" class="btn btn-success">
          <span>📊</span> Exportar a Excel
        </button>
      </form>
    </div>
    
    <!-- Panel de Administración -->
    <div class="admin-panel" id="adminPanel">
      <div class="admin-header">
        <h2>Panel de Administración</h2>
        <div>
          <button onclick="exportAllData()" class="btn btn-success">
            <span>💾</span> Exportar Todo
          </button>
        </div>
      </div>
      
      <div class="stats-cards">
        <div class="stat-card">
          <h3>Total Observaciones</h3>
          <div class="value" id="totalObservations">0</div>
        </div>
        <div class="stat-card green">
          <h3>Comportamientos Seguros</h3>
          <div class="value" id="safeObservations">0</div>
        </div>
        <div class="stat-card">
          <h3>Comportamientos Inseguros</h3>
          <div class="value" id="unsafeObservations">0</div>
        </div>
        <div class="stat-card">
          <h3>Trabajos Detenidos</h3>
          <div class="value" id="stoppedWorks">0</div>
        </div>
      </div>
      
      <div style="overflow-x: auto;">
        <table id="observationsTable">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Observador</th>
              <th>Área</th>
              <th>Tipo</th>
              <th>Actividad</th>
              <th>Severidad</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="observationsTableBody">
            <!-- Datos se cargarán dinámicamente -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Modal de Login -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <h2 style="margin-bottom: 1.5rem;">Acceso Administrador</h2>
      <form id="loginForm">
        <label for="adminEmail">Correo Electrónico</label>
        <input type="email" id="adminEmail" required>
        
        <label for="adminPassword">Contraseña</label>
        <input type="password" id="adminPassword" required>
        
        <button type="button" onclick="adminLogin()" class="btn btn-primary" style="margin-top: 1.5rem; width: 100%;">
          Iniciar Sesión
        </button>
      </form>
    </div>
  </div>

  <script>
    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyB7YAg78tcaXmLAxVow-J1KmVgyR-zd-QY",
      authDomain: "app-sgt-63275.firebaseapp.com",
      databaseURL: "https://app-sgt-63275-default-rtdb.firebaseio.com",
      projectId: "app-sgt-63275",
      storageBucket: "app-sgt-63275.appspot.com",
      messagingSenderId: "683214732490",
      appId: "1:683214732490:web:acac45eb04b37dd7f74833",
      measurementId: "G-S0919EXH0B"
    };

    // Inicializar Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    
    // Elementos del DOM
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginModal = document.getElementById('loginModal');
    const adminPanel = document.getElementById('adminPanel');
    
    // Mostrar/ocultar modal de login
    loginBtn.addEventListener('click', () => {
      loginModal.style.display = 'flex';
    });
    
    // Cerrar modal al hacer clic fuera
    loginModal.addEventListener('click', (e) => {
      if (e.target === loginModal) {
        loginModal.style.display = 'none';
      }
    });
    
    // Función de login para administradores
    async function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        
        // Verificar si es admin (en producción deberías tener esto en la base de datos)
        if (email.includes('admin')) {
          loginModal.style.display = 'none';
          loginBtn.style.display = 'none';
          logoutBtn.style.display = 'block';
          adminPanel.style.display = 'block';
          loadAdminData();
        } else {
          throw new Error('No tienes permisos de administrador');
        }
      } catch (error) {
        alert('Error de autenticación: ' + error.message);
      }
    }
    
    // Función para cargar datos en el panel de admin
    async function loadAdminData() {
      try {
        const snapshot = await db.ref('observaciones').once('value');
        
        if (!snapshot.exists()) {
          document.getElementById('observationsTableBody').innerHTML = 
            '<tr><td colspan="7">No hay observaciones registradas</td></tr>';
          return;
        }
        
        const observations = [];
        let safeCount = 0;
        let unsafeCount = 0;
        let stoppedCount = 0;
        
        snapshot.forEach(child => {
          const obs = child.val();
          observations.push({
            id: child.key,
            ...obs
          });
          
          if (obs.tipo === 'Comportamiento Seguro') safeCount++;
          else unsafeCount++;
          
          if (obs.trabajoDetenido === 'Sí') stoppedCount++;
        });
        
        // Actualizar estadísticas
        document.getElementById('totalObservations').textContent = observations.length;
        document.getElementById('safeObservations').textContent = safeCount;
        document.getElementById('unsafeObservations').textContent = unsafeCount;
        document.getElementById('stoppedWorks').textContent = stoppedCount;
        
        // Actualizar tabla
        const tableBody = document.getElementById('observationsTableBody');
        tableBody.innerHTML = '';
        
        observations.forEach(obs => {
          const row = document.createElement('tr');
          
          row.innerHTML = `
            <td>${obs.fecha} ${obs.hora}</td>
            <td>${obs.observador.nombre}</td>
            <td>${obs.area}</td>
            <td>
              <span class="badge ${obs.tipo === 'Comportamiento Seguro' ? 'badge-safe' : 'badge-unsafe'}">
                ${obs.tipo}
              </span>
            </td>
            <td>${obs.actividad}</td>
            <td>${obs.severidad || 'N/A'}</td>
            <td>
              <button onclick="viewObservation('${obs.id}')" class="btn btn-outline" style="padding: 0.5rem;">
                Ver Detalles
              </button>
            </td>
          `;
          
          tableBody.appendChild(row);
        });
      } catch (error) {
        console.error('Error cargando datos de admin:', error);
      }
    }
    
    // Función para ver detalles de una observación
    function viewObservation(observationId) {
      // Implementar lógica para mostrar detalles completos
      alert('Mostrando detalles de la observación: ' + observationId);
    }
    
    // Función para exportar todos los datos
    async function exportAllData() {
      // Similar a tu función exportToExcel pero con más campos
    }
    
    // Cerrar sesión
    logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => {
        loginBtn.style.display = 'block';
        logoutBtn.style.display = 'none';
        adminPanel.style.display = 'none';
      });
    });
    
    // Verificar estado de autenticación al cargar
    auth.onAuthStateChanged(user => {
      if (user && user.email.includes('admin')) {
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'block';
        adminPanel.style.display = 'block';
        loadAdminData();
      } else {
        loginBtn.style.display = 'block';
        logoutBtn.style.display = 'none';
        adminPanel.style.display = 'none';
      }
    });
    
    // El resto de tus funciones existentes (uploadData, exportToExcel, etc.) permanecen iguales
    // ...
  </script>
</body>
</html>